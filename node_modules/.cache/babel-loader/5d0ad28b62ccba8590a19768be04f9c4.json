{"ast":null,"code":"import store from\"../store/store\";import{setOpenRoom,setRoomDetails,setActiveRooms,setLocalStream,setRemoteStreams,setScreenSharingStream,setIsUserJoinedOnlyWithAudio}from\"../store/actions/roomActions\";import*as socketConnection from\"./socketConnection\";import*as webRTCHandler from\"./webRTCHandler\";export const createNewRoom=()=>{const successCalbackFunc=()=>{store.dispatch(setOpenRoom(true,true));const audioOnly=store.getState().room.audioOnly;store.dispatch(setIsUserJoinedOnlyWithAudio(audioOnly));socketConnection.createNewRoom();};const audioOnly=store.getState().room.audioOnly;webRTCHandler.getLocalStreamPreview(audioOnly,successCalbackFunc);};export const newRoomCreated=data=>{const{roomDetails}=data;store.dispatch(setRoomDetails(roomDetails));};export const updateActiveRooms=data=>{var _store$getState$auth$;const{activeRooms}=data;const friends=store.getState().friends.friends;const rooms=[];const userId=(_store$getState$auth$=store.getState().auth.userDetails)===null||_store$getState$auth$===void 0?void 0:_store$getState$auth$._id;activeRooms.forEach(room=>{const isRoomCreatedByMe=room.roomCreator.userId===userId;if(isRoomCreatedByMe){rooms.push({...room,creatorUsername:\"Me\"});}else{friends.forEach(f=>{if(f.id===room.roomCreator.userId){rooms.push({...room,creatorUsername:f.username});}});}});store.dispatch(setActiveRooms(rooms));};export const joinRoom=roomId=>{const successCalbackFunc=()=>{store.dispatch(setRoomDetails({roomId}));store.dispatch(setOpenRoom(false,true));const audioOnly=store.getState().room.audioOnly;store.dispatch(setIsUserJoinedOnlyWithAudio(audioOnly));socketConnection.joinRoom({roomId});};const audioOnly=store.getState().room.audioOnly;webRTCHandler.getLocalStreamPreview(audioOnly,successCalbackFunc);};export const leaveRoom=()=>{const roomId=store.getState().room.roomDetails.roomId;const localStream=store.getState().room.localStream;if(localStream){localStream.getTracks().forEach(track=>track.stop());store.dispatch(setLocalStream(null));}const screenSharingStream=store.getState().room.screenSharingStream;if(screenSharingStream){screenSharingStream.getTracks().forEach(track=>track.stop());store.dispatch(setScreenSharingStream(null));}store.dispatch(setRemoteStreams([]));webRTCHandler.closeAllConnections();socketConnection.leaveRoom({roomId});store.dispatch(setRoomDetails(null));store.dispatch(setOpenRoom(false,false));};","map":{"version":3,"names":["store","setOpenRoom","setRoomDetails","setActiveRooms","setLocalStream","setRemoteStreams","setScreenSharingStream","setIsUserJoinedOnlyWithAudio","socketConnection","webRTCHandler","createNewRoom","successCalbackFunc","dispatch","audioOnly","getState","room","getLocalStreamPreview","newRoomCreated","data","roomDetails","updateActiveRooms","_store$getState$auth$","activeRooms","friends","rooms","userId","auth","userDetails","_id","forEach","isRoomCreatedByMe","roomCreator","push","creatorUsername","f","id","username","joinRoom","roomId","leaveRoom","localStream","getTracks","track","stop","screenSharingStream","closeAllConnections"],"sources":["/home/sameeramp/Videos/Zync-Frontend/src/realtimeCommunication/roomHandler.js"],"sourcesContent":["import store from \"../store/store\";\r\nimport {\r\n  setOpenRoom,\r\n  setRoomDetails,\r\n  setActiveRooms,\r\n  setLocalStream,\r\n  setRemoteStreams,\r\n  setScreenSharingStream,\r\n  setIsUserJoinedOnlyWithAudio,\r\n} from \"../store/actions/roomActions\";\r\nimport * as socketConnection from \"./socketConnection\";\r\nimport * as webRTCHandler from \"./webRTCHandler\";\r\n\r\nexport const createNewRoom = () => {\r\n  const successCalbackFunc = () => {\r\n    store.dispatch(setOpenRoom(true, true));\r\n\r\n    const audioOnly = store.getState().room.audioOnly;\r\n    store.dispatch(setIsUserJoinedOnlyWithAudio(audioOnly));\r\n    socketConnection.createNewRoom();\r\n  };\r\n\r\n  const audioOnly = store.getState().room.audioOnly;\r\n  webRTCHandler.getLocalStreamPreview(audioOnly, successCalbackFunc);\r\n};\r\n\r\nexport const newRoomCreated = (data) => {\r\n  const { roomDetails } = data;\r\n  store.dispatch(setRoomDetails(roomDetails));\r\n};\r\n\r\nexport const updateActiveRooms = (data) => {\r\n  const { activeRooms } = data;\r\n\r\n  const friends = store.getState().friends.friends;\r\n  const rooms = [];\r\n\r\n  const userId = store.getState().auth.userDetails?._id;\r\n\r\n  activeRooms.forEach((room) => {\r\n    const isRoomCreatedByMe = room.roomCreator.userId === userId;\r\n\r\n    if (isRoomCreatedByMe) {\r\n      rooms.push({ ...room, creatorUsername: \"Me\" });\r\n    } else {\r\n      friends.forEach((f) => {\r\n        if (f.id === room.roomCreator.userId) {\r\n          rooms.push({ ...room, creatorUsername: f.username });\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  store.dispatch(setActiveRooms(rooms));\r\n};\r\n\r\nexport const joinRoom = (roomId) => {\r\n  const successCalbackFunc = () => {\r\n    store.dispatch(setRoomDetails({ roomId }));\r\n    store.dispatch(setOpenRoom(false, true));\r\n    const audioOnly = store.getState().room.audioOnly;\r\n    store.dispatch(setIsUserJoinedOnlyWithAudio(audioOnly));\r\n    socketConnection.joinRoom({ roomId });\r\n  };\r\n\r\n  const audioOnly = store.getState().room.audioOnly;\r\n  webRTCHandler.getLocalStreamPreview(audioOnly, successCalbackFunc);\r\n};\r\n\r\nexport const leaveRoom = () => {\r\n  const roomId = store.getState().room.roomDetails.roomId;\r\n\r\n  const localStream = store.getState().room.localStream;\r\n  if (localStream) {\r\n    localStream.getTracks().forEach((track) => track.stop());\r\n    store.dispatch(setLocalStream(null));\r\n  }\r\n\r\n  const screenSharingStream = store.getState().room.screenSharingStream;\r\n  if (screenSharingStream) {\r\n    screenSharingStream.getTracks().forEach((track) => track.stop());\r\n    store.dispatch(setScreenSharingStream(null));\r\n  }\r\n\r\n  store.dispatch(setRemoteStreams([]));\r\n  webRTCHandler.closeAllConnections();\r\n\r\n  socketConnection.leaveRoom({ roomId });\r\n  store.dispatch(setRoomDetails(null));\r\n  store.dispatch(setOpenRoom(false, false));\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}